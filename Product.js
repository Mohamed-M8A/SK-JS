function showTab(t,e){document.querySelectorAll('[id^="tab"]').forEach((t=>t.style.display="none")),document.querySelectorAll(".tab-buttons button").forEach((t=>t.classList.remove("active")));const n=document.getElementById(t);if(n){n.style.display="block";const t=n.getBoundingClientRect().top+window.scrollY,e=document.querySelector(".tab-buttons")?.offsetHeight||0;setTimeout((()=>{window.scrollTo({top:t-e-10,behavior:"smooth"})}),100)}e&&e.classList.add("active")}function renderStarsFromValue(){let t=parseFloat(document.getElementById("ratingValue").textContent),e=Math.floor(t),n=t%1!=0?1:0,o=5-e-n,i="";for(let t=0;t<e;t++)i+='<span class="star">★</span>';n&&(i+='<span class="star half">★</span>');for(let t=0;t<o;t++)i+='<span class="star empty">★</span>';document.getElementById("stars").innerHTML=i}document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelector(".main-image-container"),e=Array.from(document.querySelectorAll(".thumbnail-container img")),n=document.querySelector(".thumbnail-container");let o=0,i=!1;function c(c){if(c===o||i)return;i=!0;const a=c>o?-1:1,s=document.getElementById("mainImage"),l=s.cloneNode(!0);l.src=e[c].src,l.style.transform=`translateX(${100*a}%)`,l.style.transition="none",t.appendChild(l),requestAnimationFrame((()=>{l.style.transition="transform 0.3s ease",s.style.transform=`translateX(${-100*a}%)`,l.style.transform="translateX(0%)",setTimeout((()=>{t.removeChild(s),l.id="mainImage",i=!1}),300)})),e.forEach((t=>t.classList.remove("active-thumb"))),e[c].classList.add("active-thumb"),o=c,function(t){const o=e[t],i=n.getBoundingClientRect(),c=o.getBoundingClientRect();"rtl"===getComputedStyle(n).direction?c.left<i.left?n.scrollLeft+=c.left-i.left-10:c.right>i.right&&(n.scrollLeft+=c.right-i.right+10):c.left<i.left?n.scrollLeft-=i.left-c.left+10:c.right>i.right&&(n.scrollLeft+=c.right-i.right+10)}(c)}document.getElementById("thumbsRight")?.addEventListener("click",(()=>{n.scrollLeft+=240})),document.getElementById("thumbsLeft")?.addEventListener("click",(()=>{n.scrollLeft-=240})),document.getElementById("mainImageRightArrow")?.addEventListener("click",(()=>{c((o-1+e.length)%e.length)})),document.getElementById("mainImageLeftArrow")?.addEventListener("click",(()=>{c((o+1)%e.length)})),e.forEach(((t,e)=>{t.addEventListener("click",(()=>c(e)))})),c(0);const a=document.getElementById("imageModal"),s=document.getElementById("modalImage");function l(t){!function(t){const e=JSON.parse(localStorage.getItem("cart"))||[];e.some((e=>e.productUrl===t))?alert("المنتج موجود بالفعل في العربة!"):(e.push({productUrl:t}),localStorage.setItem("cart",JSON.stringify(e)),alert("تمت إضافة المنتج إلى العربة بنجاح!"))}(window.location.href)}function r(t){const e=parseFloat(t.toString().replace(/,/g,""));return isNaN(e)?t:e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}window.openModal=function(t){a&&s&&(a.style.display="flex",s.src=e[t].src,o=t)},window.closeModal=function(){a&&(a.style.display="none")},window.navigateModal=function(t){e.length&&s&&(o="next"===t?(o+1)%e.length:(o-1+e.length)%e.length,s.src=e[o].src)},document.querySelectorAll(".add-to-cart").forEach((t=>{t.removeEventListener("click",l),t.addEventListener("click",l)})),window.copyCoupon=function(){const t=document.getElementById("couponCode")?.innerText;t&&navigator.clipboard.writeText(t).then((()=>alert("تم نسخ الكوبون: "+t))).catch((t=>console.error("فشل النسخ: ",t)))};const d=document.querySelector(".buy-button");d&&(d.textContent="تسوق الآن");const u=document.querySelector(".add-to-cart");u&&(u.textContent="أضف للسلة"),document.querySelectorAll(".price-original, .price-discounted, .price-saving").forEach((t=>{const e=t.innerText.trim();if(t.classList.contains("price-saving")&&e.includes("وفر:")){const n=e.match(/وفر:\s*([\d.,]+)/);if(n&&n[1]){const e=r(n[1]);t.innerText=`وفر: ${e} ر.س`}return}const n=e.match(/[\d.,]+/);if(n){const e=r(n[0]);t.innerText=`${e} ر.س`}}));const m=document.getElementById("goToReviews");if(m){const t=m.getAttribute("data-count")||"0";m.textContent=`${t} تقييمات`}const g=document.querySelector(".shipping-fee .value");if(g){const t=g.innerText.trim().match(/[\d.,\-–]+/);if(t){const e=r(t[0]);g.innerText=`${e} ر.س`}}const p=document.querySelector(".shipping-time .value");if(p){const t=p.innerText.trim().match(/[\d\s\-–]+/);t&&(p.innerText=`${t[0]} أيام`)}function y(t,e){document.querySelectorAll('[id^="tab"]').forEach((t=>t.style.display="none")),document.querySelectorAll(".tab-buttons button").forEach((t=>t.classList.remove("active")));const n=document.getElementById(t);if(n){n.style.display="block";const t=n.getBoundingClientRect().top+window.scrollY,e=document.querySelector(".tab-buttons")?.offsetHeight||0;setTimeout((()=>{window.scrollTo({top:t-e-10,behavior:"smooth"})}),100)}e&&e.classList.add("active")}let f=setInterval((()=>{const t=document.querySelector(".tab-buttons button"),e=document.getElementById("tab1");t&&e&&(y("tab1",t),document.querySelectorAll(".tab-buttons button").forEach((t=>{t.addEventListener("click",(()=>{const e=t.getAttribute("onclick")?.match(/'(.*?)'/)?.[1];e&&y(e,t)}))})),clearInterval(f))}),100);setTimeout((()=>clearInterval(f)),5e3)})),window.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("goToReviews");t&&t.addEventListener("click",(function(t){t.preventDefault();const e=document.querySelectorAll(".tab-buttons button"),n=Array.from(e).find((t=>t.getAttribute("onclick")?.includes("'tab5'")));n&&(showTab("tab5",n),setTimeout((()=>{const t=document.getElementById("tab5");t&&t.scrollIntoView({behavior:"smooth"})}),300))}))})),renderStarsFromValue(),document.addEventListener("DOMContentLoaded",(function(){const t=document.querySelectorAll(".info-box");let e=null,n=null,o=null;t.forEach((t=>{const i=t.querySelector(".value");if(!i)return;const c=i.textContent.trim();(c.includes("متاح")||c.includes("متوفر"))&&(i.style.color="#2e7d32",i.style.fontWeight="bold"),(c.includes("غير متاح")||c.includes("غير متوفر"))&&(i.style.color="#c62828",i.style.fontWeight="bold"),t.classList.contains("shipping-fee")&&(/مجانا|مجاناً/.test(c)?(i.style.color="#2e7d32",i.style.fontWeight="bold"):(i.style.color="#222",i.style.fontWeight="normal")),t.classList.contains("sa-shipping")&&(e=c),t.classList.contains("product-availability")&&(n=c),t.classList.contains("shipping-time")&&(o=i)})),(e&&e.includes("غير")||n&&n.includes("غير"))&&o&&(o.textContent="-",o.style.color="#000",o.style.fontWeight="normal")}));const priceOriginal=parseFloat(document.querySelector(".price-original")?.textContent.trim()||0),priceDiscounted=parseFloat(document.querySelector(".price-discounted")?.textContent.trim()||0),discountEl=document.querySelector(".discount-percentage");if(priceOriginal&&priceDiscounted&&priceDiscounted<priceOriginal){const t=Math.round((priceOriginal-priceDiscounted)/priceOriginal*100);discountEl&&(discountEl.textContent=`${t}%`)}else discountEl&&(discountEl.textContent="");const avatarURL="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgwYjQ3P3sS7yC15Dqs4gAPU3sEGpftVMbqMLwaUbIk5lgxsDIxG5LseYewSYgx9ugKh5wI8ZvMZL_Oh2qZd6FD6lvHbSenXP148Iy3AHvflDx8cO6ysEGc3_nOjv4wbs9USnFA2qdgIvy-WX_ybSngrHNRqpuMSACdhRX19hoQztPYC70WNNpU8zEd/w200-h200/6VBx3io.png";function copyPostLink(t){var e=t.getAttribute("data-url");if(navigator.clipboard)navigator.clipboard.writeText(e).then((function(){alert("تم نسخ الرابط بنجاح")})).catch((function(){alert("حدث خطأ أثناء النسخ")}));else{var n=document.createElement("input");document.body.appendChild(n),n.value=e,n.select(),document.execCommand("copy"),document.body.removeChild(n),alert("تم نسخ الرابط بنجاح")}}document.querySelectorAll(".avatar-placeholder").forEach((t=>{const e=document.createElement("img");e.src=avatarURL,e.alt="أفاتار",e.className="reviewer-img",t.appendChild(e)})),document.addEventListener("DOMContentLoaded",(function(){const t=document.querySelector(".price-original"),e=document.querySelector(".price-discounted"),n=document.querySelector(".price-saving");if(t&&e&&n){const o=parseFloat(t.textContent.replace(/[^\d.]/g,"")),i=parseFloat(e.textContent.replace(/[^\d.]/g,""));if(!isNaN(o)&&!isNaN(i)&&o>i){const t=o-i;if(t<50)n.textContent="";else{const e=t.toFixed(2);n.innerHTML=`\n          <span class="save-label">وفر: </span>\n          <span class="save-amount">${e} ر.س</span>\n        `;let c="#2c3e50";if(c=t>=100&&t<200?"#1abc9c":t<400?"#2ecc71":t<600?"#e67e22":t<1e3?"#c0392b":t<1500?"#f5008b":t<2e3?"#8e44ad":"#f39c12",n.style.fontWeight="bold",n.style.color=c,n.setAttribute("title",`هذا المبلغ هو الفرق بين السعر القديم (${o.toFixed(2)}) والجديد (${i.toFixed(2)})`),t>=500){const t=document.createElement("img");t.src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj5J9EL4a9cV3VWmcK1ZYD6OYEB-1APv9gggocpaa7jAJXdgvX8Q7QiaAZC9NxcN25f8MTRSYD6SKwT1LSjL0SB1ovJH1SSkRmqH2y3f1NzWGkC0BE-gpj5bTc1OKi3Rfzh44sAAJSvOS5uq7Ut9ETN-V9LgKim0dkmEVmqUWa-2ZGA7FvMAYrVaJgn/w199-h200/fire%20(1).gif",t.alt="🔥🔥🔥",t.style.width="25px",t.style.height="25px",t.style.verticalAlign="middle",t.style.margin="0";n.querySelector(".save-amount").appendChild(t)}}}else n.textContent=""}})),document.addEventListener("DOMContentLoaded",(function(){if("undefined"==typeof priceData||!Array.isArray(priceData))return;const t={};priceData.forEach((e=>{t[e.date]||(t[e.date]={total:0,count:0}),t[e.date].total+=e.price,t[e.date].count+=1}));const e=Object.keys(t).map((e=>({date:e,price:+(t[e].total/t[e].count).toFixed(2)}))),n=e.map((t=>t.price)),o=e.map((t=>t.date)),i=Math.min(...n),c=Math.max(...n),a=+(n.reduce(((t,e)=>t+e),0)/n.length).toFixed(2),s=n[n.length-1],l=n[n.length-2]||s,r=(t,e)=>t>e?'<span class="stat-arrow arrow-up">▲</span>':t<e?'<span class="stat-arrow arrow-down">▼</span>':"",d=`\n    <div class="price-stats">\n      <div class="stat-item current"><strong>السعر الحالي:</strong> ${s} ر.س ${r(s,l)} <small style="font-size:12px;color:#666;">(${(s-l).toFixed(2)} ر.س)</small></div>\n      <div class="stat-item"><strong>المتوسط:</strong> ${a} ر.س ${r(a,s)}</div>\n      <div class="stat-item"><strong>أقل سعر:</strong> ${i} ر.س ${r(i,s)}</div>\n      <div class="stat-item"><strong>أعلى سعر:</strong> ${c} ر.س ${r(c,s)}</div>\n    </div>\n  `;document.getElementById("priceChart")?.insertAdjacentHTML("afterend",d);const u=document.createElement("div");u.id="chart-tooltip",document.body.appendChild(u);const m=t=>{const{chart:n,tooltip:o}=t,i=u;if(0===o.opacity)return i.style.opacity=0,void(i.style.display="none");i.style.display="block",i.style.opacity=1;const c=o.dataPoints[0].dataIndex,a=o.dataPoints[0].raw,s=c>0?e[c-1].price:a,l=+(a-s).toFixed(2),r=0!==s?(l/s*100).toFixed(1):0,d=l>0?'<span class="stat-arrow arrow-up">▲</span>':l<0?'<span class="stat-arrow arrow-down">▼</span>':'<span class="stat-arrow">-</span>',m=e[c].date;i.innerHTML=`\n  <div class="tooltip-line" style="font-weight:bold;">${m}</div>\n  <div class="tooltip-line">السعر: ${a} ر.س</div>\n  <div class="tooltip-line">التغير: ${d} ${l} ر.س</div>\n  <div class="tooltip-line">النسبة: ${r}%</div>\n`;const g=n.canvas.getBoundingClientRect();i.style.opacity=1;const p=window.innerWidth,y=g.left+window.pageXOffset+o.caretX;i.style.left=y>.7*p?y-160-20+"px":y+10+"px",i.style.top=g.top+window.pageYOffset+o.caretY-40+"px"},g=document.getElementById("priceChart")?.getContext("2d");g&&new Chart(g,{type:"line",data:{labels:o,datasets:[{label:"السعر (ر.س)",data:e.map((t=>t.price)),borderColor:"#2c3e50",backgroundColor:"rgba(44,62,80,0.1)",borderWidth:3,pointRadius:4,pointHoverRadius:6,fill:!0,tension:.2}]},options:{responsive:!0,interaction:{mode:"index",intersect:!1},plugins:{tooltip:{enabled:!1,external:m}},scales:{x:{title:{display:!0,text:"التاريخ",color:"#333",font:{size:14}},ticks:{color:"#333"},grid:{color:"rgba(0, 0, 0, 0.05)"}},y:{title:{display:!0,text:"السعر (ر.س)",color:"#333",font:{size:14}},ticks:{color:"#333"},grid:{color:"rgba(0, 0, 0, 0.05)"}}}}})}));
